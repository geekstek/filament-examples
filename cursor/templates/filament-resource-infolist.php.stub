<?php

declare(strict_types=1);

namespace Geekstek\XXX\Filament\Resources\YYY\Schemas; // XXX替换为实际的业务命名空间, YYY替换为模型名(复数)

use Filament\Infolists\Components\IconEntry;
use Filament\Infolists\Components\TextEntry;
use Filament\Schemas\Components\Grid;
use Filament\Schemas\Components\Section;
use Filament\Schemas\Schema;

class YYYInfolist
{
    public const TRANSLATIONS = 'XXX::resources/YYY.';
    
    public static function configure(Schema $schema): Schema
    {
        return $schema
            ->components([
                Section::make('基本信息')
                    ->schema([
                        Grid::make(2)
                            ->schema([
                                TextEntry::make('community.name')
                                    ->label('社区')
                                    ->badge()
                                    ->color('info'),

                                TextEntry::make('asset.name')
                                    ->label('资产')
                                    ->weight('bold')
                                    ->description(fn ($record) => $record->asset?->full_address ?? null),

                                TextEntry::make('feeType.name')
                                    ->label('费用类型')
                                    ->badge()
                                    ->color('primary'),
                            ]),
                    ]),

                Section::make('收费设置')
                    ->schema([
                        Grid::make(3)
                            ->schema([
                                TextEntry::make('billing_cycle')
                                    ->label('收费周期')
                                    ->badge()
                                    ->color(fn ($state) => $state?->getColor()),

                                TextEntry::make('billing_day')
                                    ->label('每期出账日')
                                    ->suffix('号'),

                                TextEntry::make('quantity_locked')
                                    ->label('锁定数量')
                                    ->numeric(decimalPlaces: 2)
                                    ->placeholder('使用资产面积'),
                            ]),
                    ]),

                Section::make('有效期')
                    ->schema([
                        Grid::make(3)
                            ->schema([
                                TextEntry::make('effective_from')
                                    ->label('生效日期')
                                    ->date('Y-m-d'),

                                TextEntry::make('effective_until')
                                    ->label('失效日期')
                                    ->date('Y-m-d')
                                    ->placeholder('永久'),

                                IconEntry::make('is_active')
                                    ->label('状态')
                                    ->boolean()
                                    ->trueIcon('heroicon-o-check-circle')
                                    ->falseIcon('heroicon-o-x-circle')
                                    ->trueColor('success')
                                    ->falseColor('danger'),
                            ]),
                    ]),

                Section::make('出账信息')
                    ->schema([
                        Grid::make(2)
                            ->schema([
                                TextEntry::make('last_billed_period_end')
                                    ->label('最后出账至')
                                    ->date('Y-m-d')
                                    ->placeholder('未出账'),

                                TextEntry::make('next_period_start')
                                    ->label('下次出账起')
                                    ->state(fn ($record) => $record->getNextPeriodStart()?->format('Y-m-d'))
                                    ->placeholder('未设置'),
                            ]),
                    ]),

                Section::make('系统信息')
                    ->schema([
                        Grid::make(2)
                            ->schema([
                                TextEntry::make('created_at')
                                    ->label('创建时间')
                                    ->dateTime('Y-m-d H:i:s'),

                                TextEntry::make('updated_at')
                                    ->label('更新时间')
                                    ->dateTime('Y-m-d H:i:s'),
                            ]),
                    ])
                    ->collapsed(),
            ]);
    }
}
